<!DOCTYPE html>
<html>
<head>
  <title>Location Form</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  
  <style>
    body { font-family: sans-serif; padding: 20px; max-width: 600px; margin: 0 auto; }
    input, button { width: 100%; padding: 10px; margin-bottom: 10px; box-sizing: border-box; }
    #map { height: 300px; margin-bottom: 15px; border-radius: 8px; border: 1px solid #ccc; }
    .hidden { display: none; }
    button { background-color: #007bff; color: white; border: none; cursor: pointer; }
    button:hover { background-color: #0056b3; }
    button.secondary { background-color: #6c757d; }
  </style>
</head>
<body>

  <h2>Submit Location</h2>

  <form name="submit-to-google-sheet">
    <input name="Name" type="text" placeholder="Your Name" required>
    
    <input name="Latitude" type="text" id="lat" placeholder="Latitude" readonly required>
    <input name="Longitude" type="text" id="lng" placeholder="Longitude" readonly required>

    <button type="button" class="secondary" onclick="getLocation()">üìç Get My Current Location</button>
    <p style="text-align:center; margin: 10px 0;">OR Click on the Map</p>
    
    <div id="map"></div>

    <button type="submit" id="submitBtn">Submit Form</button>
  </form>

  <p id="status"></p>

  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

  <script>
    // 1. Initialize Map
    // Default view (London), will update if user allows location
    var map = L.map('map').setView([51.505, -0.09], 13); 
    var marker;

    // Add OpenStreetMap tiles (Free, no API key needed)
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      maxZoom: 19,
      attribution: '¬© OpenStreetMap'
    }).addTo(map);

    // 2. Function to update inputs and marker when location is found/clicked
    function updateLocation(lat, lng) {
        document.getElementById('lat').value = lat;
        document.getElementById('lng').value = lng;

        if (marker) {
            marker.setLatLng([lat, lng]);
        } else {
            marker = L.marker([lat, lng]).addTo(map);
        }
        map.setView([lat, lng], 15);
    }

    // 3. "Get My Location" Button Logic
    function getLocation() {
      if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition((position) => {
            updateLocation(position.coords.latitude, position.coords.longitude);
        }, () => {
            alert("Unable to retrieve your location.");
        });
      } else {
        alert("Geolocation is not supported by this browser.");
      }
    }

    // 4. Click on Map Logic
    map.on('click', function(e) {
        updateLocation(e.latlng.lat, e.latlng.lng);
    });

    // 5. Send Data to Google Sheets
    const scriptURL = 'https://script.google.com/macros/s/AKfycbyX5vpCt0PhVhKFKZgvckc-pEdkgHc5JKFwmgKGz-SagP-5aL5PKYsTgd9h2OW_fAQsDw/exec'; // <--- PASTE YOUR GOOGLE SCRIPT URL HERE
    const form = document.forms['submit-to-google-sheet'];
    const status = document.getElementById('status');
    const submitBtn = document.getElementById('submitBtn');

    form.addEventListener('submit', e => {
      e.preventDefault();
      submitBtn.disabled = true;
      submitBtn.innerHTML = "Sending...";

      fetch(scriptURL, { method: 'POST', body: new FormData(form)})
        .then(response => {
            status.innerHTML = "‚úÖ Success! Data saved to Sheet.";
            submitBtn.innerHTML = "Submit Form";
            submitBtn.disabled = false;
            form.reset();
            // Optional: Reset map
        })
        .catch(error => {
            status.innerHTML = "‚ùå Error! " + error.message;
            submitBtn.disabled = false;
        });
    });
  </script>
</body>
</html>